# Coco-Ai フロントエンド (Flutter)

> Google Cloud Japan AI Hackathon vol.3 応募作品

このディレクトリは、親子対話AI「Coco-Ai」のフロントエンドアプリケーションです。
Flutter (Web) を使用して構築されています。

## 役割

このアプリケーションは、ユーザー（親子）が直接操作するインターフェースを提供します。

-   **UI/UX**: 子供向けのキャラクター（ココ、アイ）やイラストを表示し、楽しい対話体験を提供します。
-   **音声入出力**: 子供の質問をマイクで受け付け、バックエンドから返ってきた解説を音声で再生します。
-   **Firebase連携**:
    -   **Authentication**: ユーザー認証を行います。
    -   **Cloud Functions**: 音声ファイルアップロードの開始時に、署名付きURLとジョブIDを取得するためにHTTPS Callable Functionを呼び出します。
    -   **Cloud Storage**: 取得した署名付きURLを使い、録音した音声ファイルを直接アップロードします。
    -   **Firestore**: バックエンドの処理状況と結果（生成されたファイルのパスなど）をリアルタイムに監視（リッスン）します。

## 開発について

### 状態管理

このアプリケーションの状態管理には **Riverpod** を採用しています。
UIの状態（録音中、処理中、結果表示など）は `app/lib/providers/app_state_provider.dart` で定義された `AppStateNotifier` によって一元管理されます。
UIコンポーネントは `ConsumerWidget` を継承し、Providerを監視（watch）することで、状態の変更に応じてリアクティブに再描画されます。

### ディレクトリ構成 (`lib` 以下)

-   `constants/`: アセットのパスやAPIのエンドポイントなど、アプリ全体で利用する定数を管理します。
-   `models/`: アプリケーションの状態 (`AppState`) や、Firestoreから取得するデータモデルを定義します。
-   `providers/`: RiverpodのProviderを定義し、状態管理やビジネスロジックを記述します。
-   `screens/`: アプリケーションの各画面を構成するUIウィジェットを配置します。

## 開発フロー

### 1. 前提条件

-   Flutter SDK がインストールされていること。
-   Firebase CLI がインストール・設定されていること。

### 2. 依存関係のインストール

プロジェクトのルートディレクトリにある `app` フォルダに移動し、以下のコマンドを実行して必要なパッケージをインストールします。

```bash
# app ディレクトリに移動
cd app

# 依存パッケージをインストール
flutter pub get
```

### 3. ローカルでの動作確認

このアプリはバックエンド（Cloud Functions, Firestore）と連携します。ローカルで開発する際は、Firebase Emulator Suiteを使用すると便利です。

1.  **Firebaseエミュレーターの起動**: プロジェクトのルートディレクトリで以下のコマンドを実行します。
    ```bash
    firebase emulators:start
    ```
2.  **Flutterアプリの実行**: `app` ディレクトリで以下のコマンドを実行し、Chromeでアプリを起動します。アプリは自動的にローカルのエミュレーターに接続します。
    ```bash
    flutter run -d chrome
    ```

#### VSCodeからの実行

1.  `app/lib/main.dart` ファイルをエディタで開きます。
2.  VSCodeの右下にあるステータスバーをクリックし、起動したいデバイス（例: `Chrome (web-javascript)`）を選択します。
3.  `F5`キーを押すか、メニューバーから「実行」>「デバッグの開始」を選択すると、選択したデバイスでアプリが起動します。

ホットリロード機能により、コードを保存するだけで変更が即座にアプリに反映されます。




### 4. デプロイ

アプリケーションをFirebase Hostingにデプロイします。

1.  **Web用のビルド**: `app` ディレクトリで以下のコマンドを実行し、デプロイ用のファイルを生成します。
    ```bash
    flutter build web
    ```
2.  **Hostingへのデプロイ**: プロジェクトのルートディレクトリで以下のコマンドを実行します。
    ```bash
    firebase deploy --only hosting
    ```

### 5. 依存関係の更新

プロジェクトで使用しているパッケージを更新する際は、以下の手順を推奨します。

1.  **更新の確認**:
    まず、どのパッケージに新しいバージョンがあるかを確認します。
    ```bash
    flutter pub outdated
    ```

2.  **安全な更新 (推奨)**:
    破壊的変更を含まない、マイナーバージョンおよびパッチバージョンのアップデートを適用します。これにより、既存のコードへの影響を最小限に抑えられます。
    ```bash
    flutter pub upgrade
    ```

3.  **メジャーバージョンの更新 (注意が必要)**:
    メジャーバージョンを更新する場合、APIの変更によりコードの修正が必要になる可能性が高いです。`pubspec.yaml` のバージョン番号を直接編集し、`flutter pub get` を実行します。更新後は、各パッケージのマイグレーションガイドを確認し、十分なテストを行ってください。
